# 基期PSM分析 - 2009年

## 📋 分析概述

本文件夹包含使用2009年作为基期的倾向得分匹配（PSM）分析代码和结果。

### 分析参数

- **基期年份**: 2009年
- **卡尺**: 0.05
- **匹配变量**:
  1. `ln_real_gdp` - 对数实际GDP
  2. `ln_人口密度` - 对数人口密度
  3. `ln_金融发展水平` - 对数金融发展水平
  4. `第二产业占GDP比重` - 第二产业占GDP比重

### 匹配方法

- **算法**: 1:1 近邻匹配 (Nearest Neighbor Matching)
- **倾向得分计算**: Logistic回归
- **距离度量**: 倾向得分绝对差值
- **约束**: 卡尺 = 0.05

## 🚀 使用方法

### 方法1: 一键运行 (推荐)

双击运行 `run_psm.bat` 文件，将自动完成以下步骤：
1. 数据探索和变量检查
2. PSM匹配分析
3. 生成所有结果文件

### 方法2: 手动运行

在命令行中执行：

```bash
cd c:\Users\HP\Desktop\did-0206\psm_analysis_2009
python psm_analysis.py
```

## 📁 文件说明

### 输入文件

- `../总数据集_已合并_含碳排放_new.xlsx` - 原始数据集

### 脚本文件

- `01_explore_data.py` - 数据探索脚本
- `psm_analysis.py` - PSM分析主脚本
- `run_psm.bat` - 一键运行脚本
- `run_explore.bat` - 数据探索运行脚本

### 输出文件

运行后将生成以下文件：

#### 数据文件

1. **matched_data_2009.xlsx** - 匹配后的完整数据
   - 包含匹配成功的处理组和对照组数据
   - 包含倾向得分信息
   - 可直接用于后续DID分析

2. **matched_pairs_2009.xlsx** - 匹配对信息
   - treated_city: 处理组城市
   - control_city: 对照组城市
   - treated_ps: 处理组倾向得分
   - control_ps: 对照组倾向得分
   - ps_distance: 得分距离

#### 报告文件

3. **psm_report_2009.txt** - 详细分析报告
   - 分析设置
   - 样本信息
   - 匹配结果统计
   - 平衡性检验结果
   - 结论和建议

#### 图表文件

4. **psm_score_distribution.png** - 倾向得分分布图
   - 对比匹配前后处理组和对照组的倾向得分分布

5. **psm_balance_check.png** - 平衡性检验图
   - 各变量在匹配前后的均值对比

6. **psm_std_bias.png** - 标准化偏差对比图
   - 各变量匹配前后的标准化偏差
   - 包含10%阈值参考线

## 📊 平衡性判断标准

- **优秀**: 标准化偏差 < 5%
- **良好**: 标准化偏差 5%-10%
- **可接受**: 标准化偏差 10%-20%
- **需改进**: 标准化偏差 > 20%

判断原则：
1. 单个变量匹配后偏差应 < 10%
2. 平均标准化偏差应 < 10%
3. 所有变量偏差应显著降低

## 🔧 参数调整

如需调整匹配参数，请修改 `psm_analysis.py` 中的以下参数：

```python
# 第26行: 调整卡尺
caliper = 0.05  # 可改为 0.01, 0.03, 0.1 等

# 第18行: 调整基期年份
df_base = df[df['year'] == 2009].copy()  # 可改为其他年份

# 第55-58行: 调整匹配变量
match_vars = [
    'ln_real_gdp',
    'ln_人口密度',
    'ln_金融发展水平',
    '第二产业占GDP比重'
]
```

## 📈 后续分析

匹配完成后，可以使用以下文件进行后续分析：

1. **DID分析**: 使用 `matched_data_2009.xlsx` 作为样本
2. **稳健性检验**: 调整卡尺或匹配变量重新匹配
3. **安慰剂检验**: 使用其他年份作为伪政策时点

## ⚠️ 注意事项

1. 确保数据集中包含政策变量（treat、policy等）
2. 检查匹配变量的缺失值情况
3. 如果匹配成功率过低，考虑增大卡尺或减少匹配变量
4. 如果平衡性检验不通过，考虑：
   - 增加匹配变量
   - 使用不同的匹配方法
   - 检查政策变量的定义

## 📞 技术支持

如有问题，请检查：
1. Python环境和依赖库是否已安装（pandas, numpy, sklearn, matplotlib, seaborn, openpyxl）
2. 数据文件路径是否正确
3. 变量名称是否与数据集一致

---

**生成时间**: 2026-02-06
**分析师**: Claude Code
