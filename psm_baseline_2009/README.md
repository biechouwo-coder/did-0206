# 基期PSM分析（2009年）

## 📁 目录结构

```
psm_baseline_2009/
├── run_psm.py              # 增强版PSM分析主脚本
├── README.md               # 本文件
└── results/                # 结果输出目录
    ├── matched_data.xlsx          # 匹配后的数据（192个样本，96对）
    ├── balance_test.xlsx          # 平衡性检验详细结果
    ├── matching_stats.xlsx        # 匹配统计信息
    ├── propensity_scores.xlsx     # 倾向得分
    ├── PSM分析报告.txt            # 完整文本报告
    ├── ps_distribution.png        # 倾向得分分布图
    ├── std_bias_comparison.png    # 标准化差异对比图
    └── bias_reduction.png         # 偏差减少效果图
```

## 🎯 分析目的

使用2009年作为基期，对低碳城市试点进行倾向得分匹配（PSM），为后续的多期DID分析提供高质量的匹配样本。

## 📊 研究设计

### 基期设定
- **基期年份**: 2009年（政策实施前一年）
- **理由**: 低碳城市试点政策于2010年启动，使用2009年数据确保政策前特征

### 匹配变量（协变量）
1. **ln_real_gdp**: 实际GDP对数 - 衡量经济发展水平
2. **ln_人口密度**: 人口密度对数 - 衡量城市化程度
3. **ln_金融发展水平**: 金融发展水平对数 - 衡量金融发展程度
4. **第二产业占GDP比重**: 第二产业占比 - 衡量产业结构

### 匹配参数
- **匹配方法**: 最近邻匹配（Nearest Neighbor Matching）
- **匹配比例**: 1:1（每个处理组匹配1个对照组）
- **卡尺（Caliper）**: 0.05（倾向得分差异不超过0.05）
- **是否放回**: 无放回抽样（不放回）

## 📈 主要结果

### 1. 样本匹配情况
```
处理组（试点城市）:    122个
成功匹配数量:          96个
未匹配数量:            26个
匹配成功率:            78.69%
```

### 2. 倾向得分统计
```
处理组均值:  0.4870 ± 0.2037
对照组均值:  0.3597 ± 0.1304
得分范围:    [0.1665, 0.9407]
```

### 3. Logistic回归系数
| 变量 | 系数 |
|------|------|
| ln_real_gdp | 0.4322 |
| ln_人口密度 | 0.1404 |
| ln_金融发展水平 | 0.5510 |
| 第二产业占GDP比重 | -0.0468 |

### 4. 协变量平衡性检验

| 变量 | 匹配前StdDiff(%) | 匹配后StdDiff(%) | 偏差减少(%) | 平衡性 |
|------|------------------|------------------|-------------|--------|
| ln_real_gdp | 53.75 | **0.46** | 99.15 | ✓ |
| ln_人口密度 | 39.20 | **3.83** | 90.24 | ✓ |
| ln_金融发展水平 | 57.26 | **1.33** | 97.69 | ✓ |
| 第二产业占GDP比重 | 4.99 | **2.19** | 56.17 | ✓ |

**判断标准**: 标准化差异 < 10% 认为满足平衡性

**结果**: ✅ **所有4个变量都满足平衡性要求！**

### 5. 匹配质量评估

| 指标 | 结果 | 评价 |
|------|------|------|
| 匹配成功率 | 78.69% | 中等（96/122个成功匹配） |
| 平衡性检验 | 4/4个变量满足 | ✅ 优秀 |
| 平均偏差减少 | 85.81% | ✅ 优秀 |
| 匹配后最大StdDiff | 3.83% | ✅ 优秀（<5%） |

## 📊 可视化图表

### 1. 倾向得分分布图（ps_distribution.png）
- 展示匹配前后处理组和对照组的倾向得分分布
- 匹配后两组分布更加接近

### 2. 标准化差异对比图（std_bias_comparison.png）
- 对比匹配前后各协变量的标准化差异
- 所有变量匹配后都远低于10%阈值

### 3. 偏差减少效果图（bias_reduction.png）
- 展示每个协变量的偏差减少百分比
- 所有变量偏差减少都超过50%

## 🚀 使用方法

### 运行PSM分析
```bash
# 确保在项目根目录
cd c:\Users\HP\Desktop\did-0206

# 运行PSM分析脚本
py -3.8 psm_baseline_2009\run_psm.py
```

### 输入数据要求
脚本会自动读取 `总数据集_已合并_含碳排放_new.xlsx`，需包含：
- `city_name`: 城市名称
- `year`: 年份
- `Treat`: 处理组标识（1=试点城市，0=非试点城市）
- 4个匹配变量：ln_real_gdp, ln_人口密度, ln_金融发展水平, 第二产业占GDP比重

### 输出文件
运行完成后，在 `psm_baseline_2009/results/` 目录下生成：
1. **matched_data.xlsx**: 96对匹配样本（192行），可用于后续DID分析
2. **balance_test.xlsx**: 平衡性检验详细数据
3. **matching_stats.xlsx**: 匹配统计信息
4. **propensity_scores.xlsx**: 所有城市的倾向得分
5. **PSM分析报告.txt**: 完整的分析报告
6. **3个可视化图表**: PNG格式，300 DPI

## 💡 结论与建议

### ✅ 优势
1. **平衡性极佳**: 所有4个变量匹配后标准化差异都<5%
2. **偏差大幅减少**: 平均偏差减少85.81%
3. **样本充足**: 96对匹配样本足够进行DID分析

### ⚠️ 注意事项
1. **匹配成功率78.69%**: 有26个试点城市未能匹配，建议：
   - 尝试增大卡尺（如0.1）以提高匹配率
   - 使用有放回抽样
   - 尝试1:2或1:3匹配

2. **未匹配城市**: 可能因为倾向得分过高或过低，需要单独分析

### 📌 下一步建议
1. ✅ **直接使用匹配样本进行DID分析**
   - 使用96对匹配样本进行多期DID估计
   - 检查平行趋势假设
   - 进行安慰剂检验

2. **可选优化**（如果需要）:
   - 尝试不同卡尺值（0.03, 0.1）
   - 使用核匹配或局部线性回归匹配
   - 增加匹配比例（1:2, 1:3）

## 🔧 技术细节

### 倾向得分计算
使用Logistic回归模型（协变量标准化）：
```
P(Treat=1|X) = 1 / (1 + exp(-β·X_std))
```

### 匹配算法
对每个处理组单位i，在对照组中找到倾向得分最接近的单位j，满足：
```
|PS_i - PS_j| ≤ caliper (0.05)
无放回抽样：每个对照组只能被匹配一次
```

### 平衡性检验
标准化差异计算：
```
StdDiff = |X̄_treated - X̄_control| / SD_pooled × 100%
```

## 📚 参考文献

1. Rosenbaum, P. R., & Rubin, D. B. (1983). The central role of the propensity score in observational studies for causal effects. *Biometrika*, 70(1), 41-55.
2. Austin, P. C. (2011). An Introduction to Propensity Score Methods for Reducing the Effects of Confounding in Observational Studies. *Multivariate Behavioral Research*, 46(3), 399-424.

---

**创建时间**: 2026-02-07
**基期**: 2009年
**卡尺**: 0.05
**匹配样本**: 96对
**分析工具**: Python + scikit-learn + matplotlib
